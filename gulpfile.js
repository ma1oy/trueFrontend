"use strict";function cinit(s){if(conf=YAML.load(cdir),data=conf.prj,plg=conf.plg,dest=conf.dir.dest,src=conf.dir.src,conf.dir.watch)for(var e in src)src.hasOwnProperty(e)&&(watch[e]=conf.dir.watch[e]||src[e]);else watch=src;s()}function go(){return require("through2").obj(function(s,e,a){a(null,s)})}function no(s){s()}function reload(s){$.browserSync.reload(),s()}var cdir="config.yml",gulp=require("gulp"),YAML=require("yamljs"),conf=YAML.load(cdir),$={},dest={},src={},watch={},data={},plg={};Object.keys(require("./package.json").dependencies).forEach(function(s){$[s.replace("gulp-","").replace(/-[a-z]/g,function(s,e,a){return a[++e].toUpperCase()})]=require(s)}),cinit(function(){}),gulp.task("build:svg",function(s){gulp.src(src.svg).pipe(data.mcb.svg[0]?$.svgmin():go()).pipe($.rename(function(s){var e=s.dirname.split(s.sep);"."==e[0]?e.shift():!0,e.push(s.basename),s.basename=e.join("-")})).pipe($.svgstore({inlineSvg:!0})).pipe(gulp.dest(dest.svg)),s()}),gulp.task("build:html",function(s){gulp.src(src.html).pipe(data.pre.html?$[data.pre.html]({data:data}):go()).pipe(data.mcb.html[0]?$.htmlmin({collapseWhitespace:!0}):go()).pipe(gulp.dest(dest.html)),s()}),gulp.task("build:img",function(s){gulp.src(src.img).pipe(data.mcb.img[0]?$.imagemin({progressive:!0,svgoPlugins:[{removeViewBox:!1}],use:[$.imageminPngquant()],interlaced:!0}):go()).pipe(gulp.dest(dest.img)),s()}),gulp.task("build:css",function(s){gulp.src(src.css).pipe($.sourcemaps.init()).pipe(data.pre.css?$[data.pre.css](data.preOpt[data.pre.css]).on("error",$[data.pre.css].logError):go()).pipe($.autoprefixer(plg.autoprefixer)).pipe(data.mcb.css[0]?$.cleanCss():go()).pipe($.sourcemaps.write(dest.srcMap)).pipe(gulp.dest(dest.css)),s()}),gulp.task("build:js",function(s){gulp.src(src.js).pipe($.sourcemaps.init()).pipe(data.pre.js?$[data.pre.js](data.preOpt[data.pre.js]):go()).pipe(data.mcb.js[0]?$.uglify():go()).pipe($.sourcemaps.write(dest.srcMap)).pipe(gulp.dest(dest.js)),s()}),gulp.task("clean",function(s){var e=data.mcb,a=[];for(var t in e)e.hasOwnProperty(t)&&(e[t][1]?a.push(dest[t]):0);$.del(a,plg.del),s()}),gulp.task("build",gulp.series(gulp.parallel(data.mcb.css[2]?"build:css":no,data.mcb.js[2]?"build:js":no,data.mcb.svg[2]?"build:svg":no,data.mcb.img[2]?"build:img":no),data.mcb.html[2]?"build:html":no)),gulp.task("sync",function(s){$.browserSync.init(plg.browserSync),s()}),gulp.task("watch",function(s){gulp.watch(watch.html,gulp.series("build:html",reload)),gulp.watch(watch.css,gulp.series("build:css",reload)),gulp.watch(watch.js,gulp.series("build:js",reload)),gulp.watch(watch.svg,gulp.series("build:svg",reload)),gulp.watch(watch.img,gulp.series("build:img",reload)),gulp.watch(cdir,gulp.series(cinit,"build",reload)),s()}),gulp.task("default",gulp.parallel(gulp.series("build","sync"),"watch"));
